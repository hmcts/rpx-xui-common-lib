<div class="govuk-form-group" [formGroup]="addressFormGroup"
  [ngClass]="{'govuk-form-group--error': optionErrorsPresent}">
  @if (optionErrorsPresent) {
    <p class="govuk-error-message">
      <span class="govuk-visually-hidden">Error:</span>{{optionErrorMessage}}
    </p>
  }
  @if (postcodeLookupVisible()) {
    <div>
      <span class="govuk-label"><strong>Provide address details</strong></span>
      <div class="govuk-body postcode-lookup" id="addressLookup"
        [ngClass]="{'govuk-form-group--error': missingPostcode || postcodeErrorPresent(true)}">
        <label for="postcodeInput">
          <span class="govuk-hint">Enter a UK postcode</span>
        </label>
        @if (missingPostcode || postcodeErrorPresent(true)) {
          <p class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span>{{postcodeErrorMessage}}
          </p>
        }
        <div class="govuk-body">
          <input type="text" [ngClass]="{'govuk-input--error': missingPostcode}" id="postcodeInput" name="postcode"
            class="govuk-input govuk-!-width-one-third postcodeinput inline-block" formControlName="postcode">
          <button type="button" class="govuk-button find-address" (click)="findAddress()">Find address</button>
        </div>
      </div>
      @if (addressOptions) {
        <div class="govuk-body" id="selectAddress">
          <div class="govuk-body" [ngClass]="{'govuk-form-group--error': postcodeErrorPresent(false)}">
            <label class="govuk-label" for="addressList">
              <span class="form-label">Select an address</span>
            </label>
            @if (postcodeErrorPresent(false)) {
              <p class="govuk-error-message">
                <span class="govuk-visually-hidden">Error:</span>{{selectErrorMessage}}
              </p>
            }
            <select class="form-control govuk-select ccd-dropdown addressList" id="addressList" name="address"
              formControlName="addressList" (change)="addressSelected()" focusElement>
              @for (addressOption of addressOptions; track addressOption) {
                <option [ngValue]="addressOption.value">
                  {{addressOption.description}}
                </option>
              }
            </select>
          </div>
        </div>
      }
      @if (!shouldShowDetailFields() || (!startedInternational && !addressChosen)) {
        <a class="manual-link govuk-link"
        (click)="blankAddress()" href="javascript:void(0)">I can't enter a UK postcode</a>
      }
    </div>
  }

  @if (shouldShowDetailFields() && internationalMode && startedInternational && !addressChosen) {
    <div id="govuk-radios" class="govuk-radios" data-module="govuk-radios"
      >
      <div class="govuk-radios__item">
        <input class="govuk-radios__input" id="yes" value="yes" name="ukAddress" type="radio"
          data-aria-controls="address-fields" (click)="setInternationalAddress(false)" formControlName="ukAddress">
        <label class="govuk-label govuk-radios__label" for="yes">
          Yes
        </label>
      </div>
      <div class="govuk-radios__item">
        <input class="govuk-radios__input" id="no" value="no" name="ukAddress" type="radio"
          data-aria-controls="address-fields" (click)="setInternationalAddress(true)" formControlName="ukAddress">
        <label class="govuk-label govuk-radios__label" for="no">
          No
        </label>
      </div>
      <div class="govuk-radios__conditional" id="address-fields">
        @if (isInternational !== undefined) {
          <xuilib-write-address-inputs [formGroup]="formGroup"
            [isInternational]="isInternational" [submissionAttempted]="submissionAttempted">
          </xuilib-write-address-inputs>
        }
      </div>
    </div>
  }

  @if (shouldShowDetailFields() && (addressChosen || !internationalMode)) {
    <xuilib-write-address-inputs
      [formGroup]="formGroup" [isInternational]="false" [submissionAttempted]="submissionAttempted">
    </xuilib-write-address-inputs>
  }

</div>